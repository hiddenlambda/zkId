# simple identity
a(ap, ak)
    - app(apk)
    register(app=hash(apk)): sign(app, ak)
        checkIfNotExists(p)

# federated identity with signed request
f(fp, fk):
    - p(k), ap(ak), app(apk)
    directAuth(p, r, s=sign(r, k))
        verfifySign(s, r, p)
    register(p, ap, app, s=a.register(app))
        checkIfNotExists(p)
        verfifySign(s, app, ap)
    federatedAuth(p, ap, r, s=sign(r, apk))
        verfifySign(s, r, app=f[p,ap])

# federated identity with relationship concealment
g(gp, gk) <- f:
    - p(k), ap(ak), e
    directAuth ...
    register(p, ap, e=hash(apk, app, a.register(app)))
        checkIfNotExists(p)
    federatedAuth(p, ap, r, s=hash(r, apk), pr=createProof((r, s, ap, e),(apk, app, sapp),proofCircuit))
        checkProof(pr, (r, s, ap, e=f[p,ap]))
    proofCircuit(public=(r, s, ap, e), witness=(apk, app, sapp)) = 0 iff
        - e = hash(apk, app, sapp)
        - app = hash(apk)
        - s = hash(r, apk)
        - verfifySign(sapp, app, ap)

Test Inputs:

ak 1997011358982923168928344992199991480689546837621580239342656433234255379025
ap 14897476871502190904409029696666322856887678969656209656241038339251270171395 16668832459046858928951622951481252834155254151733002984053501254009901876174

apk 16759518316066956028648133618650005133986410582943746822168826420948158960537
app 1711356323507237180552937552317790917782970328860998733130523775749559859825 14095131731246428772852652665573772750096871572312120894325648105939092536841

sapp 6653879935135833326519292125513679914119544030320662754542239053554843453363 18919648821618331850457232598124671942045810113683818797357610720162599996699 16999324988678094014413126051409816769310394553952861847897766388921148405739
r 13312206719627098874168759804347904582498488044967882065977142948748931990763

s 12125799899353855163991940668916578061641253018174002385476054871552615039670 9148334995842036380314155204329397437571130746499932699042090306134831769150
e 3015674289675036089259553450165583961201513871195695108231935715875610887140 18882497022612657942862977184181925672793316152072449454130279159641189631344
